{% extends 'base.html' %}

{% load static %}

{% block head_title %}
{{ thread.title }} - Forums
{% endblock head_title %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'forums.css' %}">
{% endblock %}

{% block content %}
<main class="forums-page">
    <div class="forums-container">
        <!-- Back Button -->
        <div style="margin-bottom: 24px;">
            <a href="{% url 'support' %}" class="btn-forums-secondary">
                <i class="fas fa-arrow-left"></i> Back to Forums
            </a>
        </div>

        <!-- Thread Detail Card -->
        <div class="thread-detail-card">
            <div class="thread-detail-header">
                <div>
                    <h1 class="thread-detail-title">{{ thread.title }}</h1>
                    <p class="thread-detail-meta">
                        Posted by <strong>{{ thread.author_username }}</strong> · {{ thread.created_at|timesince }} ago · {{ thread.category|title }}
                    </p>
                </div>
                <div class="thread-detail-actions">
                    <span class="status-badge status-{{ thread.status }}">{{ thread.status }}</span>
                    {% if username == thread.author_username %}
                    <div class="dropdown">
                        <button class="btn-forums-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            Change Status
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{% url 'change_thread_status' thread.id 'open' %}">
                                <i class="fas fa-check-circle text-success me-2"></i> Open
                            </a></li>
                            <li><a class="dropdown-item" href="{% url 'change_thread_status' thread.id 'resolved' %}">
                                <i class="fas fa-check-double text-info me-2"></i> Resolved
                            </a></li>
                            <li><a class="dropdown-item" href="{% url 'change_thread_status' thread.id 'closed' %}">
                                <i class="fas fa-times-circle text-danger me-2"></i> Closed
                            </a></li>
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Messages -->
            <div class="messages-list">
                {% for message in messages %}
                <div class="message-item {% if message.is_admin_reply %}admin-reply{% endif %}">
                    <div class="message-avatar">
                        {{ message.author_username|first|upper }}
                    </div>
                    <div class="message-content-wrapper">
                        <div class="message-header">
                            <span class="message-author">{{ message.author_username }}</span>
                            {% if message.is_admin_reply %}
                            <span class="staff-badge">Staff</span>
                            {% endif %}
                            <span class="message-time">{{ message.created_at|timesince }} ago</span>
                        </div>
                        <div class="message-body">
                            {{ message.content|linebreaks }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Reply Form -->
        {% if username %}
        <div class="reply-card">
            <h3 class="reply-card-title">Post a Reply</h3>
            <form method="POST">
                {% csrf_token %}
                <textarea class="reply-textarea" name="content" placeholder="Write your reply here..." required></textarea>
                <button type="submit" class="btn-forums-primary">
                    <i class="fas fa-paper-plane"></i> Post Reply
                </button>
            </form>
        </div>
        {% else %}
        <div class="reply-card" style="text-align: center;">
            <p style="margin: 0; color: #64748b;">
                <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" style="color: #55bcc9; font-weight: 500;">Log in</a> to reply to this thread.
            </p>
        </div>
        {% endif %}
    </div>
</main>
{% endblock %}